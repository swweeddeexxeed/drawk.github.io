<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–†–∏—Å–æ–≤–∞–Ω–∏–µ —Ä—É–∫–æ–π - –ü–ö, –ü–ª–∞–Ω—à–µ—Ç, –¢–µ–ª–µ—Ñ–æ–Ω</title>
    
    <!-- MediaPipe –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä—É–∫ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <style>
        /* ========== –û–ë–©–ò–ï –°–¢–ò–õ–ò –î–õ–Ø –í–°–ï–• –£–°–¢–†–û–ô–°–¢–í ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(145deg, #0b1721, #1a2a3a);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            color: white;
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        /* ========== –≠–ö–†–ê–ù –ó–ê–ü–£–°–ö–ê ========== */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #0a1f2e, #0a2a3a);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: opacity 0.5s;
        }
        
        .start-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .start-content {
            max-width: 600px;
            width: 100%;
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: clamp(20px, 6vw, 40px);
            border-radius: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .start-icon {
            font-size: clamp(60px, 15vw, 100px);
            margin-bottom: 20px;
            animation: float 3s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .start-screen h2 {
            font-size: clamp(24px, 6vw, 40px);
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .start-screen p {
            font-size: clamp(14px, 4vw, 18px);
            margin-bottom: 30px;
            opacity: 0.9;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .device-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .device-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 14px;
        }
        
        .device-badge span {
            font-size: 24px;
        }
        
        .start-btn {
            padding: clamp(15px, 4vw, 20px) clamp(30px, 8vw, 60px);
            font-size: clamp(18px, 5vw, 24px);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: block;
        }
        
        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(78, 205, 196, 0.5);
        }
        
        .start-btn:active {
            transform: translateY(0);
        }
        
        /* ========== –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ========== */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
            background: linear-gradient(145deg, #0b1721, #1a2a3a);
            overflow: hidden;
        }
        
        /* –®–ê–ü–ö–ê */
        .header {
            background: rgba(10, 25, 35, 0.95);
            backdrop-filter: blur(10px);
            padding: clamp(8px, 3vw, 15px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header h1 {
            font-size: clamp(18px, 5vw, 24px);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: clamp(12px, 4vw, 14px);
            padding: 5px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 50px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            transition: all 0.3s;
            box-shadow: 0 0 10px #ff4444;
        }
        
        .status-dot.active {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        
        /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† - –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –°–ï–¢–ö–ê */
        .main-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }
        
        /* –ö–ê–ù–í–ê–° –î–õ–Ø –†–ò–°–û–í–ê–ù–ò–Ø */
        .canvas-wrapper {
            position: relative;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            aspect-ratio: 16/10;
            width: 100%;
            height: 100%;
            min-height: 0;
        }
        
        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            touch-action: none;
        }
        
        /* –ò–ù–î–ò–ö–ê–¢–û–† –ñ–ï–°–¢–ê */
        .gesture-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            color: white;
            padding: clamp(8px, 2vw, 12px) clamp(15px, 3vw, 25px);
            border-radius: 50px;
            font-size: clamp(14px, 4vw, 16px);
            font-weight: bold;
            z-index: 50;
            border: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .gesture-indicator.drawing {
            background: rgba(0, 255, 136, 0.9);
            color: black;
            animation: glow 1.5s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(0,255,136,0.5); }
            to { box-shadow: 0 0 20px rgba(0,255,136,0.8); }
        }
        
        /* –ü–ê–ù–ï–õ–¨ –ö–ê–ú–ï–†–´ –ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .camera-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 5px;
            height: 100%;
        }
        
        /* –í–ò–î–ï–û –ö–û–ù–¢–ï–ô–ù–ï–† */
        .video-container {
            position: relative;
            background: black;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            aspect-ratio: 4/3;
            width: 100%;
        }
        
        #input_video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #output_canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }
        
        /* –ö–û–ù–¢–†–û–õ–´ */
        .controls {
            background: rgba(20, 35, 45, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: clamp(15px, 4vw, 20px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #e0e0e0;
            font-size: clamp(14px, 4vw, 15px);
        }
        
        /* –ü–ê–õ–ò–¢–†–ê –¶–í–ï–¢–û–í */
        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }
        
        .color-btn {
            aspect-ratio: 1;
            border-radius: 12px;
            border: 3px solid transparent;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }
        
        .color-btn:hover, .color-btn:active {
            transform: scale(0.95);
            border-color: white;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.5);
        }
        
        .color-btn.active {
            border-color: white;
            box-shadow: 0 0 0 3px #4ecdc4;
        }
        
        #customColor {
            aspect-ratio: 1;
            width: 100%;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            background: transparent;
        }
        
        #customColor::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        #customColor::-webkit-color-swatch {
            border: 3px solid white;
            border-radius: 12px;
        }
        
        /* –°–õ–ê–ô–î–ï–† –†–ê–ó–ú–ï–†–ê */
        .size-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            border: 2px solid #4ecdc4;
            transition: all 0.2s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover,
        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }
        
        .size-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #000;
            border: 2px solid white;
            transition: all 0.2s;
        }
        
        /* –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: clamp(12px, 3vw, 15px);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: clamp(14px, 4vw, 15px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: white;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .btn-primary { background: linear-gradient(145deg, #667eea, #764ba2); }
        .btn-danger { background: linear-gradient(145deg, #ff6b6b, #ee5a6f); }
        .btn-success { background: linear-gradient(145deg, #11998e, #38ef7d); }
        .btn-warning { background: linear-gradient(145deg, #f093fb, #f5576c); }
        
        /* –ò–ù–°–¢–†–£–ö–¶–ò–ò */
        .instructions {
            background: rgba(20, 35, 45, 0.95);
            backdrop-filter: blur(10px);
            padding: clamp(15px, 4vw, 20px);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            color: #4ecdc4;
            font-size: clamp(16px, 4vw, 18px);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .gesture-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .gesture-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: clamp(13px, 4vw, 14px);
            color: #e0e0e0;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .gesture-icon {
            font-size: 24px;
            min-width: 40px;
            text-align: center;
        }
        
        /* ========== –ê–î–ê–ü–¢–ò–í –î–õ–Ø –ü–õ–ê–ù–®–ï–¢–û–í ========== */
        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }
            
            .camera-panel {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                overflow: visible;
            }
            
            .video-container {
                aspect-ratio: 16/9;
            }
            
            .controls, .instructions {
                height: fit-content;
            }
            
            .gesture-indicator {
                top: 10px;
                right: 10px;
                font-size: 13px;
                padding: 8px 15px;
            }
        }
        
        /* ========== –ê–î–ê–ü–¢–ò–í –î–õ–Ø –¢–ï–õ–ï–§–û–ù–û–í ========== */
        @media (max-width: 600px) {
            .main-grid {
                padding: 10px;
                gap: 10px;
            }
            
            .camera-panel {
                grid-template-columns: 1fr;
            }
            
            .video-container {
                aspect-ratio: 16/12;
                max-height: 200px;
            }
            
            .header {
                padding: 8px 12px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .status {
                padding: 4px 10px;
                font-size: 12px;
            }
            
            .controls {
                padding: 15px;
            }
            
            .color-palette {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: 1fr 1fr;
            }
            
            .gesture-indicator {
                top: 10px;
                right: 10px;
                left: 10px;
                width: auto;
                font-size: 12px;
                padding: 8px;
                justify-content: center;
            }
            
            .gesture-item {
                font-size: 12px;
                padding: 6px;
            }
            
            .gesture-icon {
                font-size: 20px;
                min-width: 30px;
            }
        }
        
        /* ========== –ê–î–ê–ü–¢–ò–í –î–õ–Ø –û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ò–• –≠–ö–†–ê–ù–û–í ========== */
        @media (max-width: 350px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .color-palette {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        /* ========== –ü–û–î–î–ï–†–ñ–ö–ê –ë–û–õ–¨–®–ò–• –≠–ö–†–ê–ù–û–í ========== */
        @media (min-width: 1800px) {
            .main-grid {
                grid-template-columns: 1fr 380px;
                padding: 30px;
            }
            
            .controls, .instructions {
                padding: 25px;
            }
            
            .color-palette {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        /* ========== –û–†–ò–ï–ù–¢–ê–¶–ò–Ø –ù–ê –ü–õ–ê–ù–®–ï–¢–ê–• ========== */
        @media (orientation: landscape) and (max-width: 900px) {
            .camera-panel {
                grid-template-columns: 1fr 1.5fr;
            }
            
            .video-container {
                aspect-ratio: 4/3;
            }
        }
        
        @media (orientation: portrait) and (max-width: 900px) {
            .camera-panel {
                grid-template-columns: 1fr;
            }
            
            .video-container {
                aspect-ratio: 16/12;
            }
        }
        
        /* ========== –°–ï–ù–°–û–†–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø ========== */
        @media (hover: none) and (pointer: coarse) {
            button, .color-btn, input[type="range"] {
                padding: 15px;
            }
            
            button {
                padding: 15px;
                min-height: 50px;
            }
            
            .gesture-item {
                padding: 12px;
            }
            
            .color-btn {
                min-height: 50px;
            }
            
            input[type="range"]::-webkit-slider-thumb {
                width: 28px;
                height: 28px;
            }
        }
        
        /* ========== –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ========== */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(145deg, #0a1a1a, #0a1a2a);
            }
        }
        
        /* ========== –°–ö–†–û–õ–õ ========== */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(78, 205, 196, 0.8);
        }
    </style>
</head>
<body>
    <!-- –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
    <div class="start-screen" id="startScreen">
        <div class="start-content">
            <div class="start-icon">üé®</div>
            <h2>–†–∏—Å–æ–≤–∞–Ω–∏–µ —Ä—É–∫–æ–π</h2>
            <p>
                –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö!<br>
                üì± –¢–µ–ª–µ—Ñ–æ–Ω ‚Ä¢ üíª –ü–ö ‚Ä¢ üìü –ü–ª–∞–Ω—à–µ—Ç
            </p>
            
            <div class="device-badges">
                <div class="device-badge">
                    <span>üñêÔ∏è</span>
                    <small>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É–∫</small>
                </div>
                <div class="device-badge">
                    <span>üé®</span>
                    <small>–†–∏—Å–æ–≤–∞–Ω–∏–µ</small>
                </div>
                <div class="device-badge">
                    <span>‚ú®</span>
                    <small>–ñ–µ—Å—Ç—ã</small>
                </div>
            </div>
            
            <button class="start-btn" onclick="startApp()">
                üöÄ –ù–∞—á–∞—Ç—å —Ä–∏—Å–æ–≤–∞—Ç—å
            </button>
            
            <p style="margin-top: 20px; font-size: 14px; opacity: 0.7;">
                üëÜ –ü–æ–¥–Ω–∏–º–∏—Ç–µ –ø–∞–ª–µ—Ü = —Ä–∏—Å–æ–≤–∞—Ç—å<br>
                ‚úä –°–æ–∂–º–∏—Ç–µ –∫—É–ª–∞–∫ = —Å—Ç–æ–ø
            </p>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- –®–ê–ü–ö–ê -->
        <div class="header">
            <h1>
                <span>üé®</span> –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ä—É–∫–æ–π
            </h1>
            <div class="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">–ó–∞–ø—É—Å–∫...</span>
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–ê–Ø –°–ï–¢–ö–ê -->
        <div class="main-grid">
            <!-- –ö–ê–ù–í–ê–° –î–õ–Ø –†–ò–°–û–í–ê–ù–ò–Ø -->
            <div class="canvas-wrapper">
                <canvas id="drawingCanvas"></canvas>
                <div class="gesture-indicator" id="gestureIndicator">
                    <span>‚úã</span> –û–∂–∏–¥–∞–Ω–∏–µ —Ä—É–∫–∏...
                </div>
            </div>

            <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
            <div class="camera-panel">
                <!-- –í–ò–î–ï–û –° –ö–ê–ú–ï–†–´ -->
                <div class="video-container">
                    <video id="input_video"></video>
                    <canvas id="output_canvas"></canvas>
                </div>

                <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
                <div class="controls">
                    <div class="control-group">
                        <label>üé® –¶–≤–µ—Ç –∫–∏—Å—Ç–∏</label>
                        <div class="color-palette">
                            <div class="color-btn active" style="background: #000000" data-color="#000000"></div>
                            <div class="color-btn" style="background: #ff0000" data-color="#ff0000"></div>
                            <div class="color-btn" style="background: #00ff00" data-color="#00ff00"></div>
                            <div class="color-btn" style="background: #0000ff" data-color="#0000ff"></div>
                            <div class="color-btn" style="background: #ffff00" data-color="#ffff00"></div>
                            <div class="color-btn" style="background: #ff00ff" data-color="#ff00ff"></div>
                            <div class="color-btn" style="background: #00ffff" data-color="#00ffff"></div>
                            <div class="color-btn" style="background: #ff8800" data-color="#ff8800"></div>
                            <div class="color-btn" style="background: #ff44aa" data-color="#ff44aa"></div>
                            <input type="color" id="customColor" value="#000000">
                        </div>
                    </div>

                    <div class="control-group">
                        <label>üìè –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏: <span id="sizeValue">5</span>px</label>
                        <div class="size-control">
                            <input type="range" id="brushSize" min="1" max="50" value="5">
                            <div class="size-circle" id="sizeCircle"></div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-danger" onclick="clearCanvas()">
                            <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                        <button class="btn-primary" onclick="undo()">
                            <span>‚Ü©Ô∏è</span> –û—Ç–º–µ–Ω–∏—Ç—å
                        </button>
                        <button class="btn-success" onclick="saveImage()">
                            <span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                        <button class="btn-warning" onclick="toggleMirror()">
                            <span>ü™û</span> –ó–µ—Ä–∫–∞–ª–æ
                        </button>
                    </div>
                </div>

                <!-- –ò–ù–°–¢–†–£–ö–¶–ò–ò -->
                <div class="instructions">
                    <h3>
                        <span>üìñ</span> –ö–∞–∫ —Ä–∏—Å–æ–≤–∞—Ç—å:
                    </h3>
                    <div class="gesture-list">
                        <div class="gesture-item">
                            <span class="gesture-icon">üëÜ</span>
                            <span><strong>–ü–∞–ª–µ—Ü –≤–≤–µ—Ä—Ö</strong> ‚Äî —Ä–∏—Å–æ–≤–∞–Ω–∏–µ</span>
                        </div>
                        <div class="gesture-item">
                            <span class="gesture-icon">‚úä</span>
                            <span><strong>–ö—É–ª–∞–∫</strong> ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</span>
                        </div>
                        <div class="gesture-item">
                            <span class="gesture-icon">üñêÔ∏è</span>
                            <span><strong>–õ–∞–¥–æ–Ω—å</strong> ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</span>
                        </div>
                        <div class="gesture-item">
                            <span class="gesture-icon">üí°</span>
                            <span><strong>–°–æ–≤–µ—Ç:</strong> –•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ = –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let canvas, ctx;
        let videoElement, canvasElement, canvasCtx;
        let hands, camera;
        let isDrawing = false;
        let lastX = null, lastY = null;
        let currentColor = '#000000';
        let currentSize = 5;
        let history = [];
        let historyStep = -1;
        let isMirrored = true;
        let isAppRunning = false;
        let lastDrawX = null, lastDrawY = null;

        // ========== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==========
        function startApp() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('appContainer').style.display = 'flex';
            
            setTimeout(() => {
                initDrawingCanvas();
                initCamera();
                isAppRunning = true;
            }, 100);
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø CANVAS –î–õ–Ø –†–ò–°–û–í–ê–ù–ò–Ø ==========
        function initDrawingCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            const wrapper = document.querySelector('.canvas-wrapper');
            canvas.width = wrapper.clientWidth;
            canvas.height = wrapper.clientHeight;
            
            // –ë–µ–ª—ã–π —Ñ–æ–Ω
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–Ω–∏–∏
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = currentSize;
            ctx.strokeStyle = currentColor;
            
            saveState();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∞—Å–∞–Ω–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            setupTouchDrawing();
        }

        // ========== –ü–û–î–î–ï–†–ñ–ö–ê –†–ò–°–û–í–ê–ù–ò–Ø –ü–ê–õ–¨–¶–ï–ú ==========
        function setupTouchDrawing() {
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
                const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
                
                isDrawing = true;
                lastDrawX = x;
                lastDrawY = y;
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isDrawing) return;
                
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
                const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
                
                if (lastDrawX !== null && lastDrawY !== null) {
                    drawLine(lastDrawX, lastDrawY, x, y);
                }
                
                lastDrawX = x;
                lastDrawY = y;
            });

            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                isDrawing = false;
                lastDrawX = null;
                lastDrawY = null;
                saveState();
            });

            canvas.addEventListener('touchcancel', (e) => {
                e.preventDefault();
                isDrawing = false;
                lastDrawX = null;
                lastDrawY = null;
                saveState();
            });
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–ê–ú–ï–†–´ ==========
        function initCamera() {
            videoElement = document.getElementById('input_video');
            canvasElement = document.getElementById('output_canvas');
            canvasCtx = canvasElement.getContext('2d');

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
            canvasElement.width = 320;
            canvasElement.height = 240;

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MediaPipe Hands
            hands = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });

            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.7,
                minTrackingConfidence: 0.7
            });

            hands.onResults(onResults);

            // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
            camera = new Camera(videoElement, {
                onFrame: async () => {
                    await hands.send({image: videoElement});
                },
                width: 320,
                height: 240
            });

            camera.start().then(() => {
                document.getElementById('statusDot').classList.add('active');
                document.getElementById('statusText').textContent = '–ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞';
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã:', err);
                document.getElementById('statusText').textContent = '–ù–µ—Ç –∫–∞–º–µ—Ä—ã';
                alert('–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∏—Å–æ–≤–∞—Ç—å –ø–∞–ª—å—Ü–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ!');
            });
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø ==========
        function onResults(results) {
            // –û—á–∏—Å—Ç–∫–∞ canvas
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                
                // –†–∏—Å—É–µ–º —Å–∫–µ–ª–µ—Ç —Ä—É–∫–∏
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {
                    color: '#00FF88',
                    lineWidth: 2
                });
                
                drawLandmarks(canvasCtx, landmarks, {
                    color: '#FF3366',
                    lineWidth: 1,
                    radius: 4
                });

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∂–µ—Å—Ç
                const gesture = detectGesture(landmarks);
                updateGestureUI(gesture);

                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–ª—å—Ü–∞
                const indexTip = landmarks[8];
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                let x = indexTip.x * canvas.width;
                let y = indexTip.y * canvas.height;

                // –ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                if (isMirrored) {
                    x = canvas.width - x;
                }

                // –†–∏—Å–æ–≤–∞–Ω–∏–µ
                if (gesture === 'drawing') {
                    if (!isDrawing) {
                        isDrawing = true;
                        lastDrawX = x;
                        lastDrawY = y;
                    } else {
                        if (lastDrawX !== null && lastDrawY !== null) {
                            drawLine(lastDrawX, lastDrawY, x, y);
                        }
                        lastDrawX = x;
                        lastDrawY = y;
                    }
                } else {
                    if (isDrawing) {
                        isDrawing = false;
                        saveState();
                    }
                    lastDrawX = null;
                    lastDrawY = null;
                }

                // –†–∏—Å—É–µ–º –∫—É—Ä—Å–æ—Ä
                drawCursor(x, y, gesture === 'drawing');

            } else {
                updateGestureUI('no-hand');
                isDrawing = false;
                lastDrawX = null;
                lastDrawY = null;
            }

            canvasCtx.restore();
        }

        // ========== –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ñ–ï–°–¢–û–í ==========
        function detectGesture(landmarks) {
            // –ö–æ–Ω—á–∏–∫–∏ –ø–∞–ª—å—Ü–µ–≤
            const indexTip = landmarks[8];
            const indexPip = landmarks[6];
            const middleTip = landmarks[12];
            const middlePip = landmarks[10];
            const ringTip = landmarks[16];
            const ringPip = landmarks[14];
            const pinkyTip = landmarks[20];
            const pinkyPip = landmarks[18];

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–Ω—è—Ç –ª–∏ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–ª–µ—Ü
            const isIndexUp = indexTip.y < indexPip.y - 0.05;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≥–Ω—É—Ç—ã –ª–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞–ª—å—Ü—ã
            const isMiddleBent = middleTip.y > middlePip.y;
            const isRingBent = ringTip.y > ringPip.y;
            const isPinkyBent = pinkyTip.y > pinkyPip.y;

            // –†–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è - —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤–≤–µ—Ä—Ö, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–Ω–∏–∑
            if (isIndexUp && isMiddleBent && isRingBent && isPinkyBent) {
                return 'drawing';
            }
            
            // –ö—É–ª–∞–∫ - –≤—Å–µ –ø–∞–ª—å—Ü—ã —Å–æ–≥–Ω—É—Ç—ã
            if (!isIndexUp && isMiddleBent && isRingBent && isPinkyBent) {
                return 'fist';
            }

            return 'moving';
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ==========
        function updateGestureUI(gesture) {
            const indicator = document.getElementById('gestureIndicator');
            const statusText = document.getElementById('statusText');

            switch(gesture) {
                case 'drawing':
                    indicator.innerHTML = '<span>‚úèÔ∏è</span> –†–∏—Å–æ–≤–∞–Ω–∏–µ...';
                    indicator.classList.add('drawing');
                    statusText.textContent = '–†–∏—Å—É–µ–º —Ä—É–∫–æ–π';
                    break;
                case 'fist':
                    indicator.innerHTML = '<span>‚úä</span> –°—Ç–æ–ø';
                    indicator.classList.remove('drawing');
                    statusText.textContent = '–ö—É–ª–∞–∫ - —Å—Ç–æ–ø';
                    break;
                case 'moving':
                    indicator.innerHTML = '<span>üñêÔ∏è</span> –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ';
                    indicator.classList.remove('drawing');
                    statusText.textContent = '–†—É–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞';
                    break;
                default:
                    indicator.innerHTML = '<span>‚úã</span> –û–∂–∏–¥–∞–Ω–∏–µ —Ä—É–∫–∏...';
                    indicator.classList.remove('drawing');
                    statusText.textContent = '–ü–æ–∫–∞–∂–∏—Ç–µ —Ä—É–∫—É';
                    break;
            }
        }

        // ========== –†–ò–°–û–í–ê–ù–ò–ï –õ–ò–ù–ò–ô ==========
        function drawLine(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize;
            ctx.stroke();
        }

        // ========== –†–ò–°–û–í–ê–ù–ò–ï –ö–£–†–°–û–†–ê ==========
        function drawCursor(x, y, isActive) {
            ctx.beginPath();
            ctx.arc(x, y, currentSize + 5, 0, 2 * Math.PI);
            ctx.strokeStyle = isActive ? '#00FF88' : '#FF3366';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, 2 * Math.PI);
            ctx.fillStyle = isActive ? '#00FF88' : '#FF3366';
            ctx.fill();
        }

        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø ==========
        function saveState() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(canvas.toDataURL());
            if (history.length > 20) {
                history.shift();
                historyStep--;
            }
        }

        // ========== –û–¢–ú–ï–ù–ê ==========
        function undo() {
            if (historyStep > 0) {
                historyStep--;
                const img = new Image();
                img.src = history[historyStep];
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                };
            }
        }

        // ========== –û–ß–ò–°–¢–ö–ê ==========
        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            saveState();
        }

        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –†–ò–°–£–ù–ö–ê ==========
        function saveImage() {
            const link = document.createElement('a');
            link.download = '—Ä–∏—Å—É–Ω–æ–∫-—Ä—É–∫–æ–π-' + Date.now() + '.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ó–ï–†–ö–ê–õ–ê ==========
        function toggleMirror() {
            isMirrored = !isMirrored;
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –†–ê–ó–ú–ï–†–ê ==========
        function updateSizeCircle() {
            const circle = document.getElementById('sizeCircle');
            circle.style.width = currentSize + 'px';
            circle.style.height = currentSize + 'px';
            circle.style.background = currentColor;
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô UI ==========
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentColor = btn.dataset.color || '#000000';
                document.getElementById('customColor').value = currentColor;
                updateSizeCircle();
            });
        });

        document.getElementById('customColor').addEventListener('change', (e) => {
            currentColor = e.target.value;
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            updateSizeCircle();
        });

        document.getElementById('brushSize').addEventListener('input', (e) => {
            currentSize = parseInt(e.target.value);
            document.getElementById('sizeValue').textContent = currentSize;
            updateSizeCircle();
        });

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –†–ê–ó–ú–ï–†–ê –≠–ö–†–ê–ù–ê ==========
        window.addEventListener('resize', () => {
            if (canvas && isAppRunning) {
                const wrapper = document.querySelector('.canvas-wrapper');
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                tempCtx.drawImage(canvas, 0, 0);
                
                canvas.width = wrapper.clientWidth;
                canvas.height = wrapper.clientHeight;
                
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
                
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.lineWidth = currentSize;
                ctx.strokeStyle = currentColor;
            }
        });

        // ========== –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï –ö–ê–ú–ï–†–´ –ü–†–ò –í–´–•–û–î–ï ==========
        window.addEventListener('beforeunload', () => {
            if (camera) {
                camera.stop();
            }
        });

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        updateSizeCircle();
    </script>
</body>
</html>
